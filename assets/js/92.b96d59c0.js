(window.webpackJsonp=window.webpackJsonp||[]).push([[92],{515:function(t,s,a){"use strict";a.r(s);var n=a(28),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"react-native-fcm-ios-수신-에러"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#react-native-fcm-ios-수신-에러"}},[t._v("#")]),t._v(" react-native fcm ios 수신 에러")]),t._v(" "),a("h2",{attrs:{id:"어디서-안되는지-확인"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#어디서-안되는지-확인"}},[t._v("#")]),t._v(" 어디서 안되는지 확인")]),t._v(" "),a("ul",[a("li",[t._v("token값이 유효한지 확인")]),t._v(" "),a("li",[t._v("fcm을 통해 받은 token 값을 postman을 통해 fcm.google.com으로 쏜다.")]),t._v(" "),a("li",[t._v("결과 "),a("code",[t._v("NotRegistred")]),t._v(" 라는 결과를 얻게됨.")]),t._v(" "),a("li",[t._v("만약 CURL문 또는 postman을 쐈는데, success라고 뜬다면 fcm을 받는 "),a("code",[t._v("onMessage")]),t._v("함수 로직이 잘못됨.")])]),t._v(" "),a("h2",{attrs:{id:"fcm-send-curl문-예제"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#fcm-send-curl문-예제"}},[t._v("#")]),t._v(" fcm send curl문 예제")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('curl -X POST --header "Authorization: key=${fcm_server_key}" --header "Content-Type: application/json" https://fcm.googleapis.com/fcm/send -d \'{"to" : "${fcm_token}",  "priority" : "high",  "notification" : { "body" : "Background Message", "title" : "BG Title" }, "data" : { "title" : "FG Title", "message" : "Foreground Message" }}\'\n')])])]),a("h2",{attrs:{id:"fail이유가-notregistred"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#fail이유가-notregistred"}},[t._v("#")]),t._v(" fail이유가 NotRegistred")]),t._v(" "),a("ul",[a("li",[t._v("ios의 경우 앱이 꺼지면 fcm과 연결이 끊기면서 이전 fcm token으로 send를 보내면 NotRegistred라는 에러를 띄운다")]),t._v(" "),a("li",[t._v("그래서 해당 ios기기는 앱 실행시 다시 fcm과 새로운 token으로 연결을 시도해야한다.")]),t._v(" "),a("li",[t._v("그러나 앱에 재접속하고 getToken 함수를 실행하면 끊긴 token 값을 리턴해준다.")]),t._v(" "),a("li",[t._v("그러므로 getToken으로 받은 값과 서버에 존재하는 token 값이 같다면, deleteToken을 실행하여, fcm에 지정된 ios 기기 토큰 값을 초기화 하고, 다시 getToken을 실행하여 새로운 토큰값을 받아야한다.")])]),t._v(" "),a("h2",{attrs:{id:"해결"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#해결"}},[t._v("#")]),t._v(" 해결")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("getToken")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" oldToken "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("messaging")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getToken")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// oldToken과 서버의 token이 같다면")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("messaging")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("deleteToken")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("fcm_send_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" newToken "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("messaging")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getToken")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldToken "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" newToken"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n     console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'not refresh'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" newToken"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h2",{attrs:{id:"fail이유가-invalidregistration"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#fail이유가-invalidregistration"}},[t._v("#")]),t._v(" fail이유가 InvalidRegistration")]),t._v(" "),a("ul",[a("li",[t._v("header에 들어가는 Authorization : key=xxxxx 이 값이 이전 server key를 바라보고 있거나, 다른 프로젝트의 server key를 사용할 가능성이 크다.")]),t._v(" "),a("li",[t._v("위 이유가 아니라면 나의 경우, 같은 계정을 여러 디바이스에서 빠르게 실행하여 fcm에서 잠시 pause를 준것 처럼 느껴졌다. 약 10분이 지나니 정상 작동하였다.")])]),t._v(" "),a("TagLinks"),t._v(" "),a("Comment")],1)}),[],!1,null,null,null);s.default=e.exports}}]);