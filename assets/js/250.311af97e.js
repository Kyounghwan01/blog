(window.webpackJsonp=window.webpackJsonp||[]).push([[250],{422:function(t,s,a){"use strict";a.r(s);var n=a(21),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"vercel에-배포한-nextjs-웹을-aws로-이전하기"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vercel에-배포한-nextjs-웹을-aws로-이전하기"}},[t._v("#")]),t._v(" vercel에 배포한 nextjs 웹을 aws로 이전하기")]),t._v(" "),a("h2",{attrs:{id:"배경"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#배경"}},[t._v("#")]),t._v(" 배경")]),t._v(" "),a("ol",[a("li",[a("p",[a("strong",[t._v("비용 절감")])]),t._v(" "),a("ul",[a("li",[t._v("트래픽이 많을 경우 Vercel보다 AWS가 훨씬 저렴")])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("커스터마이징 자유도")])]),t._v(" "),a("ul",[a("li",[t._v("인프라 설정을 완전히 제어 가능")]),t._v(" "),a("li",[t._v("특정 요구사항에 맞는 맞춤형 설정 가능")])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("AWS 생태계 통합")])]),t._v(" "),a("ul",[a("li",[t._v("S3, RDS, Lambda 등 AWS 서비스와의 원활한 통합")])])])]),t._v(" "),a("h2",{attrs:{id:"아키텍처-개요"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#아키텍처-개요"}},[t._v("#")]),t._v(" 아키텍처 개요")]),t._v(" "),a("p",[t._v("배포 파이프라인은 다음과 같이 구성됩니다:")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("CodeCommit")]),t._v(": 소스 코드 관리")]),t._v(" "),a("li",[a("strong",[t._v("CodePipeline")]),t._v(": 코드 변경 감지 및 빌드 트리거")]),t._v(" "),a("li",[a("strong",[t._v("CodeBuild")]),t._v(": Docker 이미지 빌드 및 ECR 푸시")]),t._v(" "),a("li",[a("strong",[t._v("ECS")]),t._v(": ECR 이미지 변경 감지 후 자동 배포")]),t._v(" "),a("li",[a("strong",[t._v("CloudFront")]),t._v(": 정적 콘텐츠 캐싱 및 URL 라우팅")])]),t._v(" "),a("h2",{attrs:{id:"고려했던-대안-aws-amplify"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#고려했던-대안-aws-amplify"}},[t._v("#")]),t._v(" 고려했던 대안: AWS Amplify")]),t._v(" "),a("p",[t._v("더 간단한 방법으로 AWS Amplify를 사용할 수도 있습니다. Amplify는 클릭 몇 번으로 Next.js 애플리케이션을 배포할 수 있어 초기 설정이 매우 간단합니다.")]),t._v(" "),a("p",[t._v("하지만 다음 이유로 Amplify 대신 ECS 기반 아키텍처를 선택했습니다:")]),t._v(" "),a("ol",[a("li",[a("p",[a("strong",[t._v("VPC 내부망 접근 제한")])]),t._v(" "),a("ul",[a("li",[t._v("Amplify는 VPC 내부 리소스에 직접 접근하는 기능이 제한적입니다")]),t._v(" "),a("li",[t._v("내부 데이터베이스나 API와의 통합이 복잡합니다")])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("비용 효율성")])]),t._v(" "),a("ul",[a("li",[t._v("해당 프로젝트는 프론트엔드보다 API 로직이 더 많습니다")]),t._v(" "),a("li",[t._v("API 중심 워크로드의 경우 Amplify보다 ECS나 App Runner가 더 경제적입니다")]),t._v(" "),a("li",[t._v("트래픽이 증가할수록 비용 차이가 커집니다")])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("커스터마이징 요구사항")])]),t._v(" "),a("ul",[a("li",[t._v("Docker 기반 배포로 특정 런타임 환경이나 라이브러리 설치가 필요할 때 유연합니다")]),t._v(" "),a("li",[t._v("인프라 레벨의 세밀한 제어가 가능합니다")])])])]),t._v(" "),a("h2",{attrs:{id:"고려했던-대안-aws-app-runner"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#고려했던-대안-aws-app-runner"}},[t._v("#")]),t._v(" 고려했던 대안: AWS App Runner")]),t._v(" "),a("p",[t._v("AWS App Runner도 고려했지만, 다음 이유로 선택하지 않았습니다:")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("리전 제한")]),t._v(": App Runner는 현재 도쿄 리전에만 제공되며 서울 리전은 지원하지 않습니다")]),t._v(" "),a("li",[a("strong",[t._v("리전 일관성")]),t._v(": 다른 AWS 서비스들을 서울 리전에서 운영 중이므로, 리전을 통일하여 지연 시간과 데이터 전송 비용을 최적화하고자 했습니다")])]),t._v(" "),a("h2",{attrs:{id:"주요-구현-단계"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#주요-구현-단계"}},[t._v("#")]),t._v(" 주요 구현 단계")]),t._v(" "),a("h3",{attrs:{id:"_1-docker-이미지-준비"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-docker-이미지-준비"}},[t._v("#")]),t._v(" 1. Docker 이미지 준비")]),t._v(" "),a("p",[t._v("Next.js 애플리케이션을 Docker 이미지로 빌드합니다. "),a("code",[t._v("Dockerfile")]),t._v("에서 프로덕션 빌드 및 실행 설정을 구성합니다.")]),t._v(" "),a("h4",{attrs:{id:"codebuild-buildspec-yml-설정"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#codebuild-buildspec-yml-설정"}},[t._v("#")]),t._v(" CodeBuild buildspec.yml 설정")]),t._v(" "),a("p",[t._v("CodeBuild에서 사용하는 "),a("code",[t._v("buildspec.yml")]),t._v(" 파일 예시입니다. 이 파일은 Docker 이미지를 빌드하고 환경별(dev, stg, prd) ECR에 푸시하는 역할을 합니다.")]),t._v(" "),a("p",[a("strong",[t._v("주요 기능:")])]),t._v(" "),a("ul",[a("li",[a("code",[t._v("DEPLOYMENT_ENV")]),t._v(" 환경 변수에 따라 배포 환경을 제어합니다")]),t._v(" "),a("li",[t._v("개발 환경: 기본적으로 dev ECR에만 푸시")]),t._v(" "),a("li",[t._v("스테이징 환경: dev, stg ECR에 푸시")]),t._v(" "),a("li",[t._v("프로덕션 환경: dev, stg, prd ECR에 모두 푸시")]),t._v(" "),a("li",[t._v("ECS 서비스 자동 배포 트리거")])]),t._v(" "),a("div",{staticClass:"language-yml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.2")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("variables")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("IMAGE_REPO_NAME")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pet-web"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("IMAGE_TAG")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"latest"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("AWS_DEFAULT_REGION")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ap-northeast-2"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 운영 환경 설정")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("PROD_ACCOUNT_ID")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("PROD_REGION")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ap-northeast-2"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# STG 환경 설정")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("STG_ACCOUNT_ID")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("STG_REGION")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ap-northeast-2"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("phases")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("pre_build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("commands")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" DEPLOYMENT_ENV=$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("DEPLOYMENT_ENV"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"development"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(' echo "DEPLOYMENT_ENV = $DEPLOYMENT_ENV"\n      '),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ACCOUNT_ID=$(aws sts get"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("caller"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("identity "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("query Account "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("output text)\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ECR_URI=$ACCOUNT_ID.dkr.ecr.$AWS_DEFAULT_REGION.amazonaws.com/$IMAGE_REPO_NAME\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" aws ecr get"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("login"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("password "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("region $AWS_DEFAULT_REGION "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" docker login "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("username AWS "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("password"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("stdin $ECR_URI\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" echo Logged in to Amazon ECR\n      \n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 운영 환경 ECR 로그인")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" PROD_ECR_URI=$PROD_ACCOUNT_ID.dkr.ecr.$PROD_REGION.amazonaws.com/$IMAGE_REPO_NAME\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" aws ecr get"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("login"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("password "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("region $PROD_REGION "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" docker login "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("username AWS "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("password"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("stdin $PROD_ECR_URI\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" echo Logged in to Production ECR\n      \n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# STG 환경 ECR 로그인")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" STG_ECR_URI=$STG_ACCOUNT_ID.dkr.ecr.$STG_REGION.amazonaws.com/$IMAGE_REPO_NAME\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" aws ecr get"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("login"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("password "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("region $STG_REGION "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" docker login "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("username AWS "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("password"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("stdin $STG_ECR_URI\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" echo Logged in to STG ECR\n\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("commands")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" set "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("e\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" echo Build started on `date`\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" echo Building the Docker image"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" docker build "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("t $ECR_URI"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("$IMAGE_TAG .\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" echo Build completed on `date`\n\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("post_build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("commands")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" echo Build completed on `date`\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" echo Pushing the Docker image to development ECR"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" docker push $ECR_URI"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("$IMAGE_TAG\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" printf '"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v('"ImageURI"'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"%s"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("' $ECR_URI"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("$IMAGE_TAG "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v(" imageDetail.json\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),a("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v('\n        if [ "$DEPLOYMENT_ENV" = "staging" ]; then\n          echo "=== main branch: pushing to STG ECR ==="\n          docker tag $ECR_URI:$IMAGE_TAG $STG_ECR_URI:$IMAGE_TAG\n          docker push $STG_ECR_URI:$IMAGE_TAG\n          echo "Successfully pushed to STG ECR!"\n        elif [ "$DEPLOYMENT_ENV" = "production" ]; then\n          echo "=== Production: pushing to STG ECR ==="\n          docker tag $ECR_URI:$IMAGE_TAG $STG_ECR_URI:$IMAGE_TAG\n          docker push $STG_ECR_URI:$IMAGE_TAG\n          echo "Successfully pushed to STG ECR!"')]),t._v("\n\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v('echo "=== Production')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(' pushing to Production ECR ==="\n          docker tag $ECR_URI'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("$IMAGE_TAG $PROD_ECR_URI"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("$IMAGE_TAG\n          docker push $PROD_ECR_URI"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v('$IMAGE_TAG\n          echo "Successfully pushed to Production ECR'),a("span",{pre:!0,attrs:{class:"token tag"}},[t._v("!")]),t._v('"\n        else\n          '),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v('echo "Not main branch (DEPLOYMENT_ENV=$DEPLOYMENT_ENV)')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(' skipping STG/PROD push."\n        fi\n      \n      '),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ECS 자동 배포")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" echo Starting ECS deployment"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" aws ecs update"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("service "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cluster pet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("web"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cluster "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("service pet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("web"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("task"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("service "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("force"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("new"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("deployment "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("region $AWS_DEFAULT_REGION\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" aws ecs wait services"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("stable "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cluster pet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("web"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cluster "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("services pet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("web"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("task"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("service "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("region $AWS_DEFAULT_REGION\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" echo ECS deployment completed successfully"),a("span",{pre:!0,attrs:{class:"token tag"}},[t._v("!")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("artifacts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("files")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" imageDetail.json\n")])])]),a("h3",{attrs:{id:"_2-ecr-리포지토리-생성"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-ecr-리포지토리-생성"}},[t._v("#")]),t._v(" 2. ECR 리포지토리 생성")]),t._v(" "),a("p",[t._v("환경별로 Docker 이미지를 저장할 ECR 리포지토리를 생성합니다.")]),t._v(" "),a("p",[a("strong",[t._v("생성해야 할 리포지토리:")])]),t._v(" "),a("ul",[a("li",[t._v("개발 환경: "),a("code",[t._v("pet-web")]),t._v(" (또는 "),a("code",[t._v("pet-web-dev")]),t._v(")")]),t._v(" "),a("li",[t._v("스테이징 환경: 별도 AWS 계정의 "),a("code",[t._v("pet-web")]),t._v(" (STG_ACCOUNT_ID)")]),t._v(" "),a("li",[t._v("프로덕션 환경: 별도 AWS 계정의 "),a("code",[t._v("pet-web")]),t._v(" (PROD_ACCOUNT_ID)")])]),t._v(" "),a("p",[t._v("각 리포지토리는 해당 환경의 ECS 클러스터에서 이미지를 가져와 사용합니다.")]),t._v(" "),a("h3",{attrs:{id:"_3-ecs-클러스터-및-서비스-설정"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-ecs-클러스터-및-서비스-설정"}},[t._v("#")]),t._v(" 3. ECS 클러스터 및 서비스 설정")]),t._v(" "),a("p",[a("strong",[t._v("클러스터 구성:")])]),t._v(" "),a("ul",[a("li",[t._v("ECS Fargate를 사용하여 서버리스 컨테이너 실행 환경을 구성합니다")]),t._v(" "),a("li",[t._v("환경별로 별도의 클러스터를 생성하거나, 동일 클러스터 내에서 서비스로 분리할 수 있습니다")])]),t._v(" "),a("p",[a("strong",[t._v("태스크 정의:")])]),t._v(" "),a("ul",[a("li",[t._v("CPU, 메모리 리소스 할당 설정")]),t._v(" "),a("li",[t._v("환경 변수 및 Secrets Manager 연동")]),t._v(" "),a("li",[t._v("ECR 이미지 URI 지정")])]),t._v(" "),a("p",[a("strong",[t._v("서비스 설정:")])]),t._v(" "),a("ul",[a("li",[t._v("자동 스케일링 정책 구성 (CPU/메모리 사용률 기반)")]),t._v(" "),a("li",[t._v("로드 밸런서(ALB) 연결")]),t._v(" "),a("li",[t._v("헬스 체크 설정")])]),t._v(" "),a("h3",{attrs:{id:"_4-ci-cd-파이프라인-구축"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-ci-cd-파이프라인-구축"}},[t._v("#")]),t._v(" 4. CI/CD 파이프라인 구축")]),t._v(" "),a("h4",{attrs:{id:"codepipeline-설정"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#codepipeline-설정"}},[t._v("#")]),t._v(" CodePipeline 설정")]),t._v(" "),a("ul",[a("li",[t._v("CodeCommit에 코드 푸시 시 CodePipeline이 자동으로 트리거됩니다")]),t._v(" "),a("li",[t._v("CodeBuild에서 Docker 이미지 빌드 및 ECR 푸시가 실행됩니다")]),t._v(" "),a("li",[t._v("ECS 서비스가 새 이미지 감지 후 자동 배포됩니다")])]),t._v(" "),a("h4",{attrs:{id:"환경별-배포-전략-dev-stg-prd"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#환경별-배포-전략-dev-stg-prd"}},[t._v("#")]),t._v(" 환경별 배포 전략 (dev, stg, prd)")]),t._v(" "),a("p",[t._v("다중 환경을 관리하기 위한 구조:")]),t._v(" "),a("ol",[a("li",[a("p",[a("strong",[t._v("CodePipeline 분리")])]),t._v(" "),a("ul",[a("li",[t._v("환경별로 별도의 CodePipeline을 생성합니다")]),t._v(" "),a("li",[t._v("예시:\n"),a("ul",[a("li",[a("code",[t._v("pet-web-dev")]),t._v(": dev 브랜치 감지")]),t._v(" "),a("li",[a("code",[t._v("pet-web-stg")]),t._v(": stg 브랜치 감지")]),t._v(" "),a("li",[a("code",[t._v("pet-web")]),t._v(": main 브랜치 감지 (프로덕션)")])])])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("CodeBuild 환경 변수 설정")])]),t._v(" "),a("ul",[a("li",[t._v("각 CodePipeline에서 CodeBuild 실행 시 "),a("code",[t._v("DEPLOYMENT_ENV")]),t._v(" 환경 변수를 설정합니다")]),t._v(" "),a("li",[t._v("예시:\n"),a("ul",[a("li",[t._v("dev 파이프라인: "),a("code",[t._v("DEPLOYMENT_ENV=development")])]),t._v(" "),a("li",[t._v("stg 파이프라인: "),a("code",[t._v("DEPLOYMENT_ENV=staging")])]),t._v(" "),a("li",[t._v("prd 파이프라인: "),a("code",[t._v("DEPLOYMENT_ENV=production")])])])])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("buildspec.yml 환경 분기")])]),t._v(" "),a("ul",[a("li",[a("code",[t._v("DEPLOYMENT_ENV")]),t._v(" 값에 따라 배포 대상 ECR이 결정됩니다")]),t._v(" "),a("li",[t._v("development: dev ECR에만 푸시")]),t._v(" "),a("li",[t._v("staging: dev + stg ECR에 푸시")]),t._v(" "),a("li",[t._v("production: dev + stg + prd ECR에 모두 푸시")])])])]),t._v(" "),a("h3",{attrs:{id:"_5-cloudfront-설정"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-cloudfront-설정"}},[t._v("#")]),t._v(" 5. CloudFront 설정")]),t._v(" "),a("p",[a("strong",[t._v("오리진 설정:")])]),t._v(" "),a("ul",[a("li",[t._v("ECS ALB(Application Load Balancer)를 오리진으로 설정합니다")]),t._v(" "),a("li",[t._v("ALB는 ECS 서비스의 여러 태스크에 트래픽을 분산합니다")])]),t._v(" "),a("p",[a("strong",[t._v("캐싱 정책:")])]),t._v(" "),a("ul",[a("li",[t._v("정적 콘텐츠("),a("code",[t._v("/_next/static")]),t._v(", 이미지 등)에 대한 캐싱 정책 구성")]),t._v(" "),a("li",[t._v("동적 콘텐츠(API 라우트 등)는 캐싱하지 않도록 설정")])]),t._v(" "),a("p",[a("strong",[t._v("보안 및 도메인:")])]),t._v(" "),a("ul",[a("li",[t._v("HTTPS 리다이렉트 설정 (HTTP → HTTPS)")]),t._v(" "),a("li",[t._v("ACM(Amazon Certificate Manager)을 통한 SSL/TLS 인증서 설정")]),t._v(" "),a("li",[t._v("커스텀 도메인 연결")])]),t._v(" "),a("h2",{attrs:{id:"주의사항"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#주의사항"}},[t._v("#")]),t._v(" 주의사항")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("비용 관리")]),t._v(": ECS Fargate는 사용한 만큼 과금되므로 모니터링이 필요합니다")]),t._v(" "),a("li",[a("strong",[t._v("배포 시간")]),t._v(": Docker 이미지 빌드 및 배포에 시간이 소요될 수 있습니다")]),t._v(" "),a("li",[a("strong",[t._v("환경 변수 관리")]),t._v(": Secrets Manager나 Parameter Store를 활용하여 민감한 정보를 안전하게 관리합니다")]),t._v(" "),a("li",[a("strong",[t._v("로깅")]),t._v(": CloudWatch Logs를 통해 애플리케이션 로그를 중앙 집중식으로 관리합니다")])]),t._v(" "),a("TagLinks"),t._v(" "),a("Comment")],1)}),[],!1,null,null,null);s.default=e.exports}}]);